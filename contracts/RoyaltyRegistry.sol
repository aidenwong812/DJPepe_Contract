/**

www.WrappedPlatform.com
                                 ,;¿╓╖╖www╖╓;,
                        -,╓g@╨╜▒░░rⁿ*"""ⁿⁿ**≡░░▒╜MHw┌
                   .─*╖M╜░='"`                    ''^░╙ª╖,
                .*'┌╜░─'           ,▄▄▄▄▄▄▄▄▄▄▄,        `~╙*,
              .░`,           ¿▄@▓█▓▓▓▓▓▓▓▓▓▓███████▄▄,       "".
           ,g╢▓██▌-       ▄▓█▒▓╢▒▓▓▓▓▓▓▓▓▓▓▓▓▓█████████▌ç       ,▄
         ╒╣╣╣▓███▀    .g▓▓▓▒▒▒╣╣╢╢▓▓▓▓▓▓▓▓██▀`      `▀▀███Ç.,.  .╙███.
         ╣Ñ╝"▀██▀   ,║▒▒▒╫░▒▒▒▒▒╢▒╣╢▓▓▓▓▓█▒╖╓..;╖@@▓▓▄p.╙██▄ ░░░░░╜███ç
        '.,¡█▌'`   ║▒░░░"▒░▒▒▒▒▒▒▒╣╢╣▓▓▓╢████▓▒░▒▓██████▄.▀█▄ └░░░└░█▀▀
        â╣▒█▌    .░░└"'` h░░░▒▒▒▒▒╫▒╫╣▓╬▓██████████████████▓█r `*",:╨█.
       ┌╢╢▐█▒╠╫▓▌▌░!=`   µ¡░░░▒▒▒▒▒▒╫╫╣╬▒▓████████████████████µ,─¡└└░▒█.
      .╢▀╫∩█▌▒╢▒███'¿╓,  L"└░░▒▒▒▒▒▒╜╙╙╙└",,,,     ..,╓╖╥╖¡,"╙▀   '¡¡└╢█╓
     ░@▒▒¿└²█▌╙╢▒█▒▌░╢╣r ╘`'"'`   .╓p@▓▓▓▓▓▓@▄;    '╓@╣▓▓▓▓▓▓▓▄,   '▒▒░╨██╖
    ╥╣▒▒▒▒░ ██µ╠▒█▌█└╫▓▒       ,░░▒▒▒╢╢▒▒▒▀▀▀▀▀Ñµ¿░▒▒▒╢╣▓▓╣╣╢╜╜░░'  '▓╣░╙███▄.
   ╔▒╣║▒▒▒░`▐█▌:▒▒██─╣╣▒,   `,¡░░░░░░└`.'"└░░░=. └▒░░░░▄@▀" "└""└":   ║▒~╢████⌐
  \▒╣▓▓▓║▒░⌐▐█▌'▒▒██═░▒░`  `''^─«╘≡═           ``  ▒░▄▓▓∩              ::╘▐█▓█▒
  ║▒╫▒@▓▒▒░`▐█▌'▒╫▌█`└░"       ,╓╗║~               ██▓▓▒L                 ▒█▌█▌
 '▒▒╫▒▄▒▒▒░ ▓█r¡░▓▌█ '``      "╙╝▒▒═               ▓╜╢▒▒░                 Ñ█▌▓█
 ¡▒▒▒▒▒╣╣░`]▓▌,░░▓▐▌     `        ~"          ``  /░m¿.    '........,     ▒█▌▓▌
 └╢▒▒▒▒╣░r,╫▓¡░░╣▒▓      ```      `.```~,,...',⌐ .░░░░░¡.   ,─;;;≈┘"     j▐█▒▓^
  ░╣▒╣▒▒"╓╫Ñ░░░▒╣║`      ````       ```''─"""┐╓▒▓██▄▄▄└"'`    `░┐        ñ▓▓╢Ñ
   ╙▒░░╓║╫░░░░▒▒╠┘       ````              .╓▒╫▓▓▓███████▌@p╖╓╓░▒ç      /╟▓╢╩
    n░╜▓╣▒▒▒▒▒▒╟`        ````........,,;╓░▒▒╢╢▓▓▓▓▓▓█████▓▓▓╣╣╢╢╢╫   `'¡╢╣╜`
  H▒└`'└▓▓╣▒▒@╙          `..',╓╖╖╖µ|░░░░▒▒▒▒▒▒▒╢╢╣╢▓▓▓▓▓▓▓▓╣╣╣▒╣╣╫▓r.╓╨╙`
  ╙'''''''└┘ ,,.        `.:`.░░░░░░░░▒▒ÑÑ╬@▄▄▄▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▓▌└
            .▓▒░░~'``````'" '░░MH∩╖┌,,'"²░░░░░░▒▒▒▒▒▀▀▀▀▒▒▒▒▒▒▒╨▒▒
              ╢▒░¡~~'`.````` `"^=»░░░░░░░╜MHHm╥╥▄▄▄▄▄▄▄▄▄▄▄@@@╬╣▒╜
               ╨▒░¡┌~~,,''``````````  .`'"^└░░░░░░░░░░░░░░░░░░╙"
                `╨░░¡~~~~~,,,,,,,,,,,,,,,,,,,,..........,,¡¿"
                ∩░.'"░~~~~~~~~~~~~~~~~~~~:┌┌┌┌┌┌┌┌┌¡¡¡░░┴"
             ╓░┘` '-,    `'''::~~~~~""""""┌¡¡¡░░░░▒▒▓▓▄,
           .░└````...."─=,.           ```        ▒▒▓▓████╖
        .H░┌ ░░¡¡¡¡¡┌┌┌┌¡:¡└└«. .,,,....,,:¿░░░ ~▒╫▓▓██████▌ç
      ┌║░░░░┐]▒▒▒▒▒▒▒░░░░░░░¡¡¡' ┌░░░░░░░░░░░▒▒`▐▓▓▓██████████
    ╓╣▒▒╢╢╢╢▓`▓▓▓▓╣╣▒▒▒▒▒▒▒▒░░░░,`░░░░░░░▒▒▒▒╢╣.▓▓▓██▓▓▓██████▌

  _____       _   _____                  _   _ ______ _______   __  __            _        _         _                
 |  __ \     | | |  __ \                | \ | |  ____|__   __| |  \/  |          | |      | |       | |               
 | |  | |    | | | |__) |__ _ __   ___  |  \| | |__     | |    | \  / | __ _ _ __| | _____| |_ _ __ | | __ _  ___ ___ 
 | |  | |_   | | |  ___/ _ \ '_ \ / _ \ | . ` |  __|    | |    | |\/| |/ _` | '__| |/ / _ \ __| '_ \| |/ _` |/ __/ _ \
 | |__| | |__| | | |  |  __/ |_) |  __/ | |\  | |       | |    | |  | | (_| | |  |   <  __/ |_| |_) | | (_| | (_|  __/
 |_____/ \____/  |_|   \___| .__/ \___| |_| \_|_|       |_|    |_|  |_|\__,_|_|  |_|\_\___|\__| .__/|_|\__,_|\___\___|
                           | |                                                                | |                     
                           |_|                                                                |_|                     
 */
// SPDX-License-Identifier: MIT

pragma solidity ^0.8.27;

import "@openzeppelin/contracts/access/Ownable.sol";
import "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol";

import "./interfaces/IERC721NFT.sol";

contract RoyaltyRegistry is Ownable {
    uint256 public constant MAX_ROYALTY_PERCENT = 5000; // 50%

    mapping(address => uint256) public _collectionRoyalties;
    mapping(address => address) public _collectionCreators;

    event NFTRegistered(address collection);

    constructor() Ownable(msg.sender) {}

    function emergencyWithdrawToken(
        address token_,
        address to_,
        uint256 amount_
    ) public onlyOwner {
        SafeERC20.safeTransfer(IERC20(token_), to_, amount_);
    }

    function emergencyWithdrawCoin(
        address payable to_,
        uint256 amount_
    ) public onlyOwner {
        (bool result, ) = to_.call{value: amount_}("");
        require(result, "withdraw failed");
    }

    function registerERC721(address _collectionAddr) external onlyOwner {
        emit NFTRegistered(_collectionAddr);
    }

    function setCollectionRoyalty(
        address _collectionAddr,
        address _creator,
        uint256 _royalty
    ) external onlyOwner {
        require(_royalty <= MAX_ROYALTY_PERCENT, "Invalid percent");
        _collectionCreators[_collectionAddr] = _creator;
        _collectionRoyalties[_collectionAddr] = _royalty;
    }

    function getRoyalty(
        address _collectionAddr,
        uint256 _tokenId
    ) public view returns (uint256) {
        address _creator = _collectionCreators[_collectionAddr];
        if (_creator != address(0))
            return _collectionRoyalties[_collectionAddr];
        return IERC721NFT(_collectionAddr).royalties(_tokenId);
    }

    function getCreator(
        address _collectionAddr,
        uint256 _tokenId
    ) public view returns (address) {
        address _creator = _collectionCreators[_collectionAddr];
        if (_creator != address(0)) return _creator;
        return IERC721NFT(_collectionAddr).creatorOf(_tokenId);
    }
}
